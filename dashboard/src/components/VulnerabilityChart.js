import React from 'react';
import { Doughnut, Bar } from 'react-chartjs-2';
import {
  Chart as ChartJS,
  ArcElement,
  Tooltip,
  Legend,
  CategoryScale,
  LinearScale,
  BarElement,
  Title,
} from 'chart.js';

ChartJS.register(
  ArcElement,
  Tooltip,
  Legend,
  CategoryScale,
  LinearScale,
  BarElement,
  Title
);

const severityColors = {
  critical: '#d32f2f',
  high: '#f57c00',
  medium: '#fbc02d',
  low: '#388e3c',
  negligible: '#9e9e9e',
};

export function VulnerabilityDoughnut({ vulnerabilities }) {
  const data = {
    labels: ['Critical', 'High', 'Medium', 'Low', 'Negligible'],
    datasets: [
      {
        data: [
          vulnerabilities?.critical || 0,
          vulnerabilities?.high || 0,
          vulnerabilities?.medium || 0,
          vulnerabilities?.low || 0,
          vulnerabilities?.negligible || 0,
        ],
        backgroundColor: Object.values(severityColors),
        borderWidth: 2,
        borderColor: '#fff',
      },
    ],
  };

  const options = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        position: 'bottom',
      },
    },
  };

  return <Doughnut data={data} options={options} />;
}

export function VulnerabilityBar({ history }) {
  if (!history || history.length === 0) return null;

  const labels = history.map((h) =>
    new Date(h.scan_timestamp).toLocaleDateString()
  ).reverse();

  const data = {
    labels,
    datasets: [
      {
        label: 'Critical',
        data: history.map((h) => h.critical).reverse(),
        backgroundColor: severityColors.critical,
      },
      {
        label: 'High',
        data: history.map((h) => h.high).reverse(),
        backgroundColor: severityColors.high,
      },
      {
        label: 'Medium',
        data: history.map((h) => h.medium).reverse(),
        backgroundColor: severityColors.medium,
      },
      {
        label: 'Low',
        data: history.map((h) => h.low).reverse(),
        backgroundColor: severityColors.low,
      },
    ],
  };

  const options = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        position: 'top',
      },
      title: {
        display: true,
        text: 'Vulnerability Trend',
      },
    },
    scales: {
      x: {
        stacked: true,
      },
      y: {
        stacked: true,
      },
    },
  };

  return <Bar data={data} options={options} />;
}
